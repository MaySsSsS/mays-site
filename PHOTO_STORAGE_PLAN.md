# ğŸ“¸ ç…§ç‰‡å­˜å‚¨ç³»ç»Ÿ - Cloudflare R2 + Worker æ–¹æ¡ˆ

## é¡¹ç›®ä¿¡æ¯

| é…ç½®é¡¹             | å€¼                                     |
| ------------------ | -------------------------------------- |
| Cloudflare è´¦æˆ· ID | `f765f7402dd95272d6c8f6ba76a1f306`     |
| R2 å­˜å‚¨æ¡¶åç§°      | `my-photos`                            |
| Worker åç§°        | `mays-photo-api`                       |
| Worker URL         | `https://mays-photo-api.mays.workers.dev` |

---

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vue å‰ç«¯      â”‚ â”€â”€â†’ â”‚   Cloudflare Worker      â”‚ â”€â”€â†’ â”‚  R2 å­˜å‚¨æ¡¶  â”‚
â”‚ (GitHub Pages)  â”‚     â”‚  (å¯†ç è®¤è¯ + R2 ç»‘å®š)     â”‚     â”‚ (my-photos) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†‘
                        å¯†ç å­˜åœ¨è¿™é‡Œ
                     (Cloudflare Secrets)
```

### R2 å­˜å‚¨ç»“æ„

```
my-photos/
â”œâ”€â”€ metadata/
â”‚   â””â”€â”€ groups.json          # æ‰€æœ‰åˆ†ç»„æ•°æ®ï¼ˆå«ç…§ç‰‡å…ƒä¿¡æ¯ï¼‰
â””â”€â”€ images/
    â””â”€â”€ {groupId}/
        â””â”€â”€ {photoId}.jpg    # ç…§ç‰‡æ–‡ä»¶
```

---

## å®æ–½è¿›åº¦

### é˜¶æ®µä¸€ï¼šWorker é¡¹ç›®åˆ›å»º âœ… å·²å®Œæˆ

- [x] åˆ›å»º `workers/photo-api/` ç›®å½•
- [x] åˆ›å»º `wrangler.toml` é…ç½®æ–‡ä»¶ï¼ˆR2 ç»‘å®šï¼‰
- [x] åˆ›å»º `src/index.ts` Worker å…¥å£ä»£ç 
- [x] åˆ›å»º `.dev.vars` æœ¬åœ°å¯†ç æ–‡ä»¶ï¼ˆå·² gitignoreï¼‰
- [x] åˆ›å»º `tsconfig.json` TypeScript é…ç½®

### é˜¶æ®µäºŒï¼šWorker API å®ç° âœ… å·²å®Œæˆ

Worker æä¾›ä»¥ä¸‹ API ç«¯ç‚¹ï¼š

| æ–¹æ³•   | è·¯å¾„           | åŠŸèƒ½                 | éœ€è¦è®¤è¯ |
| ------ | -------------- | -------------------- | -------- |
| POST   | `/api/auth`    | éªŒè¯å¯†ç ï¼Œè¿”å› token | âŒ       |
| GET    | `/api/groups`  | è·å–æ‰€æœ‰åˆ†ç»„æ•°æ®     | âœ…       |
| POST   | `/api/groups`  | æ›´æ–°åˆ†ç»„æ•°æ®         | âœ…       |
| POST   | `/api/upload`  | ä¸Šä¼ ç…§ç‰‡             | âœ…       |
| GET    | `/api/image/*` | è·å–ç…§ç‰‡             | âœ…       |
| DELETE | `/api/image/*` | åˆ é™¤ç…§ç‰‡             | âœ…       |

### é˜¶æ®µä¸‰ï¼šå‰ç«¯æ”¹é€  âœ… å·²å®Œæˆ

- [x] åˆ›å»º `src/api/photoApi.ts` - API å°è£…
- [x] ä¿®æ”¹ `src/stores/photos.ts` - å¯¹æ¥ Worker API
- [x] æ·»åŠ ç™»å½•ç»„ä»¶ `src/components/photos/PhotoAuth.vue`
- [x] ä¿®æ”¹ `src/views/Photos/index.vue` - æ·»åŠ è®¤è¯æµç¨‹

### é˜¶æ®µå››ï¼šéƒ¨ç½² âœ… å·²å®Œæˆ

- [x] åˆ›å»º API Tokenï¼ˆWorkers + R2 æƒé™ï¼‰
- [x] éƒ¨ç½² Worker åˆ° `https://mays-photo-api.mays.workers.dev`
- [x] è®¾ç½® `AUTH_PASSWORD` å¯†ç ï¼ˆ200519ï¼‰
- [x] è®¾ç½® `JWT_SECRET` JWT å¯†é’¥
- [x] æ›´æ–°å‰ç«¯ API åœ°å€é…ç½®

### é˜¶æ®µäº”ï¼šæµ‹è¯•ä¸å‰ç«¯éƒ¨ç½² â³ å¾…å®Œæˆ

- [ ] æœ¬åœ°æµ‹è¯•è®¤è¯æµç¨‹
- [ ] æœ¬åœ°æµ‹è¯•ç…§ç‰‡ä¸Šä¼ 
- [ ] éƒ¨ç½²å‰ç«¯åˆ° GitHub Pages
- [ ] ç”Ÿäº§ç¯å¢ƒå®Œæ•´æµ‹è¯•

---

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

```
workers/
â””â”€â”€ photo-api/
    â”œâ”€â”€ wrangler.toml        # Wrangler é…ç½®ï¼ˆR2 ç»‘å®šï¼‰
    â”œâ”€â”€ tsconfig.json        # TypeScript é…ç½®
    â”œâ”€â”€ package.json         # ä¾èµ–é…ç½®
    â”œâ”€â”€ .dev.vars            # æœ¬åœ°å¼€å‘å¯†ç ï¼ˆä¸æäº¤ï¼‰
    â””â”€â”€ src/
        â””â”€â”€ index.ts         # Worker ä¸»ä»£ç 

src/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ photoApi.ts          # å‰ç«¯ API å°è£…
â””â”€â”€ components/
    â””â”€â”€ photos/
        â””â”€â”€ PhotoAuth.vue    # ç™»å½•ç»„ä»¶
```

### ä¿®æ”¹æ–‡ä»¶

```
src/stores/photos.ts         # æ”¹ç”¨ Worker API
src/components/photos/PhotoUploader.vue  # ä¸Šä¼ åˆ° Worker
src/views/Photos/index.vue   # æ·»åŠ è®¤è¯æµç¨‹
.gitignore                   # æ·»åŠ  .dev.vars
```

---

## å®‰å…¨è¯´æ˜

### å¯†ç å­˜å‚¨ä½ç½®

| ç¯å¢ƒ     | å­˜å‚¨ä½ç½®                      | å®‰å…¨æ€§                       |
| -------- | ----------------------------- | ---------------------------- |
| æœ¬åœ°å¼€å‘ | `workers/photo-api/.dev.vars` | å·² gitignoreï¼Œä¸ä¼šæäº¤       |
| ç”Ÿäº§ç¯å¢ƒ | Cloudflare Secrets            | åŠ å¯†å­˜å‚¨ï¼Œåªæœ‰ Worker èƒ½è¯»å– |

### è®¤è¯æµç¨‹

1. ç”¨æˆ·è¾“å…¥å¯†ç 
2. å‰ç«¯è°ƒç”¨ `POST /api/auth` éªŒè¯
3. Worker è¿”å› JWT tokenï¼ˆæœ‰æ•ˆæœŸ 7 å¤©ï¼‰
4. å‰ç«¯å­˜å‚¨ token åˆ° localStorage
5. åç»­è¯·æ±‚æºå¸¦ `Authorization: Bearer {token}`

---

## ä¸‹ä¸€æ­¥æ“ä½œï¼šéƒ¨ç½² Worker

ä»£ç å·²åˆ›å»ºå®Œæˆï¼è¯·åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. è¿›å…¥ Worker ç›®å½•
cd workers/photo-api

# 2. å®‰è£…ä¾èµ–
npm install

# 3. ç™»å½• Cloudflareï¼ˆä¼šæ‰“å¼€æµè§ˆå™¨ï¼‰
npx wrangler login

# 4. è®¾ç½®è®¿é—®å¯†ç ï¼ˆè¾“å…¥: 200519ï¼‰
npx wrangler secret put AUTH_PASSWORD

# 5. è®¾ç½® JWT å¯†é’¥ï¼ˆè¾“å…¥ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼‰
npx wrangler secret put JWT_SECRET

# 6. éƒ¨ç½² Worker
npx wrangler deploy
```

éƒ¨ç½²æˆåŠŸåï¼ŒWorker ä¼šè¿”å›ä¸€ä¸ª URLï¼Œå¦‚ï¼š
`https://mays-photo-api.ä½ çš„å­åŸŸå.workers.dev`

ç„¶åéœ€è¦æ›´æ–°å‰ç«¯é…ç½® `src/api/photoApi.ts` ä¸­çš„ `API_BASE` ä¸ºè¿™ä¸ª URLã€‚

---

## æ›´æ–°æ—¥å¿—

| æ—¶é—´       | æ›´æ–°å†…å®¹                           |
| ---------- | ---------------------------------- |
| 2025-11-30 | åˆ›å»ºè®¡åˆ’æ–‡æ¡£                       |
| 2025-11-30 | å®Œæˆ Worker ä»£ç åˆ›å»ºï¼ˆé˜¶æ®µä¸€ã€äºŒï¼‰ |
| 2025-11-30 | å®Œæˆå‰ç«¯æ”¹é€ ï¼ˆé˜¶æ®µä¸‰ï¼‰             |
