/**
 * è·å–ä¸­å›½åŸå¸‚ç»çº¬åº¦åæ ‡è„šæœ¬
 */
import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// åŸå¸‚åˆ—è¡¨ï¼ŒæŒ‰åœ°åŒºåˆ†ç»„
const cities = {
  åŒ—äº¬å¸‚: ["åŒ—äº¬"],
  å¤©æ´¥å¸‚: ["å¤©æ´¥"],
  ä¸Šæµ·å¸‚: ["ä¸Šæµ·"],
  é‡åº†å¸‚: ["é‡åº†"],
  æ²³åŒ—çœ: [
    "çŸ³å®¶åº„",
    "å”å±±",
    "ç§¦çš‡å²›",
    "é‚¯éƒ¸",
    "é‚¢å°",
    "ä¿å®š",
    "å¼ å®¶å£",
    "æ‰¿å¾·",
    "æ²§å·",
    "å»ŠåŠ",
    "è¡¡æ°´",
  ],
  å±±è¥¿çœ: [
    "å¤ªåŸ",
    "å¤§åŒ",
    "é˜³æ³‰",
    "é•¿æ²»",
    "æ™‹åŸ",
    "æœ”å·",
    "æ™‹ä¸­",
    "è¿åŸ",
    "å¿»å·",
    "ä¸´æ±¾",
    "å•æ¢",
  ],
  å†…è’™å¤è‡ªæ²»åŒº: [
    "å‘¼å’Œæµ©ç‰¹",
    "åŒ…å¤´",
    "ä¹Œæµ·",
    "èµ¤å³°",
    "é€šè¾½",
    "é„‚å°”å¤šæ–¯",
    "å‘¼ä¼¦è´å°”",
    "å·´å½¦æ·–å°”",
    "ä¹Œå…°å¯Ÿå¸ƒ",
    "å…´å®‰ç›Ÿ",
    "é”¡æ—éƒ­å‹’ç›Ÿ",
    "é˜¿æ‹‰å–„ç›Ÿ",
  ],
  è¾½å®çœ: [
    "æ²ˆé˜³",
    "å¤§è¿",
    "éå±±",
    "æŠšé¡º",
    "æœ¬æºª",
    "ä¸¹ä¸œ",
    "é”¦å·",
    "è¥å£",
    "é˜œæ–°",
    "è¾½é˜³",
    "ç›˜é”¦",
    "é“å²­",
    "æœé˜³",
    "è‘«èŠ¦å²›",
  ],
  å‰æ—çœ: [
    "é•¿æ˜¥",
    "å‰æ—",
    "å››å¹³",
    "è¾½æº",
    "é€šåŒ–",
    "ç™½å±±",
    "æ¾åŸ",
    "ç™½åŸ",
    "å»¶è¾¹æœé²œæ—è‡ªæ²»å·",
  ],
  é»‘é¾™æ±Ÿçœ: [
    "å“ˆå°”æ»¨",
    "é½é½å“ˆå°”",
    "é¸¡è¥¿",
    "é¹¤å²—",
    "åŒé¸­å±±",
    "å¤§åº†",
    "ä¼Šæ˜¥",
    "ä½³æœ¨æ–¯",
    "ä¸ƒå°æ²³",
    "ç‰¡ä¸¹æ±Ÿ",
    "é»‘æ²³",
    "ç»¥åŒ–",
    "å¤§å…´å®‰å²­åœ°åŒº",
  ],
  æ±Ÿè‹çœ: [
    "å—äº¬",
    "æ— é”¡",
    "å¾å·",
    "å¸¸å·",
    "è‹å·",
    "å—é€š",
    "è¿äº‘æ¸¯",
    "æ·®å®‰",
    "ç›åŸ",
    "æ‰¬å·",
    "é•‡æ±Ÿ",
    "æ³°å·",
    "å®¿è¿",
  ],
  æµ™æ±Ÿçœ: [
    "æ­å·",
    "å®æ³¢",
    "æ¸©å·",
    "å˜‰å…´",
    "æ¹–å·",
    "ç»å…´",
    "é‡‘å",
    "è¡¢å·",
    "èˆŸå±±",
    "å°å·",
    "ä¸½æ°´",
  ],
  å®‰å¾½çœ: [
    "åˆè‚¥",
    "èŠœæ¹–",
    "èšŒåŸ ",
    "æ·®å—",
    "é©¬éå±±",
    "æ·®åŒ—",
    "é“œé™µ",
    "å®‰åº†",
    "é»„å±±",
    "æ»å·",
    "é˜œé˜³",
    "å®¿å·",
    "å…­å®‰",
    "äº³å·",
    "æ± å·",
    "å®£åŸ",
  ],
  ç¦å»ºçœ: [
    "ç¦å·",
    "å¦é—¨",
    "è†ç”°",
    "ä¸‰æ˜",
    "æ³‰å·",
    "æ¼³å·",
    "å—å¹³",
    "é¾™å²©",
    "å®å¾·",
  ],
  æ±Ÿè¥¿çœ: [
    "å—æ˜Œ",
    "æ™¯å¾·é•‡",
    "èä¹¡",
    "ä¹æ±Ÿ",
    "æ–°ä½™",
    "é¹°æ½­",
    "èµ£å·",
    "å‰å®‰",
    "å®œæ˜¥",
    "æŠšå·",
    "ä¸Šé¥¶",
  ],
  å±±ä¸œçœ: [
    "æµå—",
    "é’å²›",
    "æ·„åš",
    "æ£åº„",
    "ä¸œè¥",
    "çƒŸå°",
    "æ½åŠ",
    "æµå®",
    "æ³°å®‰",
    "å¨æµ·",
    "æ—¥ç…§",
    "ä¸´æ²‚",
    "å¾·å·",
    "èŠåŸ",
    "æ»¨å·",
    "èæ³½",
  ],
  æ²³å—çœ: [
    "éƒ‘å·",
    "å¼€å°",
    "æ´›é˜³",
    "å¹³é¡¶å±±",
    "å®‰é˜³",
    "é¹¤å£",
    "æ–°ä¹¡",
    "ç„¦ä½œ",
    "æ¿®é˜³",
    "è®¸æ˜Œ",
    "æ¼¯æ²³",
    "ä¸‰é—¨å³¡",
    "å—é˜³",
    "å•†ä¸˜",
    "ä¿¡é˜³",
    "å‘¨å£",
    "é©»é©¬åº—",
  ],
  æ¹–åŒ—çœ: [
    "æ­¦æ±‰",
    "é»„çŸ³",
    "åå °",
    "å®œæ˜Œ",
    "è¥„é˜³",
    "é„‚å·",
    "è†é—¨",
    "å­æ„Ÿ",
    "è†å·",
    "é»„å†ˆ",
    "å’¸å®",
    "éšå·",
    "æ©æ–½åœŸå®¶æ—è‹—æ—è‡ªæ²»å·",
  ],
  æ¹–å—çœ: [
    "é•¿æ²™",
    "æ ªæ´²",
    "æ¹˜æ½­",
    "è¡¡é˜³",
    "é‚µé˜³",
    "å²³é˜³",
    "å¸¸å¾·",
    "å¼ å®¶ç•Œ",
    "ç›Šé˜³",
    "éƒ´å·",
    "æ°¸å·",
    "æ€€åŒ–",
    "å¨„åº•",
    "æ¹˜è¥¿åœŸå®¶æ—è‹—æ—è‡ªæ²»å·",
  ],
  å¹¿ä¸œçœ: [
    "å¹¿å·",
    "éŸ¶å…³",
    "æ·±åœ³",
    "ç æµ·",
    "æ±•å¤´",
    "ä½›å±±",
    "æ±Ÿé—¨",
    "æ¹›æ±Ÿ",
    "èŒ‚å",
    "è‚‡åº†",
    "æƒ å·",
    "æ¢…å·",
    "æ±•å°¾",
    "æ²³æº",
    "é˜³æ±Ÿ",
    "æ¸…è¿œ",
    "ä¸œè",
    "ä¸­å±±",
    "æ½®å·",
    "æ­é˜³",
    "äº‘æµ®",
  ],
  å¹¿è¥¿å£®æ—è‡ªæ²»åŒº: [
    "å—å®",
    "æŸ³å·",
    "æ¡‚æ—",
    "æ¢§å·",
    "åŒ—æµ·",
    "é˜²åŸæ¸¯",
    "é’¦å·",
    "è´µæ¸¯",
    "ç‰æ—",
    "ç™¾è‰²",
    "è´ºå·",
    "æ²³æ± ",
    "æ¥å®¾",
    "å´‡å·¦",
  ],
  æµ·å—çœ: ["æµ·å£", "ä¸‰äºš", "ä¸‰æ²™", "å„‹å·"],
  å››å·çœ: [
    "æˆéƒ½",
    "è‡ªè´¡",
    "æ”€æèŠ±",
    "æ³¸å·",
    "å¾·é˜³",
    "ç»µé˜³",
    "å¹¿å…ƒ",
    "é‚å®",
    "å†…æ±Ÿ",
    "ä¹å±±",
    "å—å……",
    "çœ‰å±±",
    "å®œå®¾",
    "å¹¿å®‰",
    "è¾¾å·",
    "é›…å®‰",
    "å·´ä¸­",
    "èµ„é˜³",
    "é˜¿åè—æ—ç¾Œæ—è‡ªæ²»å·",
    "ç”˜å­œè—æ—è‡ªæ²»å·",
    "å‡‰å±±å½æ—è‡ªæ²»å·",
  ],
  è´µå·çœ: [
    "è´µé˜³",
    "å…­ç›˜æ°´",
    "éµä¹‰",
    "å®‰é¡º",
    "æ¯•èŠ‚",
    "é“œä»",
    "é»”è¥¿å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·",
    "é»”ä¸œå—è‹—æ—ä¾—æ—è‡ªæ²»å·",
    "é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·",
  ],
  äº‘å—çœ: [
    "æ˜†æ˜",
    "æ›²é–",
    "ç‰æºª",
    "ä¿å±±",
    "æ˜­é€š",
    "ä¸½æ±Ÿ",
    "æ™®æ´±",
    "ä¸´æ²§",
    "æ¥šé›„å½æ—è‡ªæ²»å·",
    "çº¢æ²³å“ˆå°¼æ—å½æ—è‡ªæ²»å·",
    "æ–‡å±±å£®æ—è‹—æ—è‡ªæ²»å·",
    "è¥¿åŒç‰ˆçº³å‚£æ—è‡ªæ²»å·",
    "å¤§ç†ç™½æ—è‡ªæ²»å·",
    "å¾·å®å‚£æ—æ™¯é¢‡æ—è‡ªæ²»å·",
    "æ€’æ±Ÿå‚ˆåƒ³æ—è‡ªæ²»å·",
    "è¿ªåº†è—æ—è‡ªæ²»å·",
  ],
  è¥¿è—è‡ªæ²»åŒº: ["æ‹‰è¨", "æ—¥å–€åˆ™", "æ˜Œéƒ½", "æ—èŠ", "å±±å—", "é‚£æ›²", "é˜¿é‡Œåœ°åŒº"],
  é™•è¥¿çœ: [
    "è¥¿å®‰",
    "é“œå·",
    "å®é¸¡",
    "å’¸é˜³",
    "æ¸­å—",
    "å»¶å®‰",
    "æ±‰ä¸­",
    "æ¦†æ—",
    "å®‰åº·",
    "å•†æ´›",
  ],
  ç”˜è‚ƒçœ: [
    "å…°å·",
    "å˜‰å³ªå…³",
    "é‡‘æ˜Œ",
    "ç™½é“¶",
    "å¤©æ°´",
    "æ­¦å¨",
    "å¼ æ–",
    "å¹³å‡‰",
    "é…’æ³‰",
    "åº†é˜³",
    "å®šè¥¿",
    "é™‡å—",
    "ä¸´å¤å›æ—è‡ªæ²»å·",
    "ç”˜å—è—æ—è‡ªæ²»å·",
  ],
  é’æµ·çœ: [
    "è¥¿å®",
    "æµ·ä¸œ",
    "æµ·åŒ—è—æ—è‡ªæ²»å·",
    "é»„å—è—æ—è‡ªæ²»å·",
    "æµ·å—è—æ—è‡ªæ²»å·",
    "æœæ´›è—æ—è‡ªæ²»å·",
    "ç‰æ ‘è—æ—è‡ªæ²»å·",
    "æµ·è¥¿è’™å¤æ—è—æ—è‡ªæ²»å·",
  ],
  å®å¤å›æ—è‡ªæ²»åŒº: ["é“¶å·", "çŸ³å˜´å±±", "å´å¿ ", "å›ºåŸ", "ä¸­å«"],
  æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº: [
    "ä¹Œé²æœ¨é½",
    "å…‹æ‹‰ç›ä¾",
    "åé²ç•ª",
    "å“ˆå¯†",
    "æ˜Œå‰å›æ—è‡ªæ²»å·",
    "åšå°”å¡”æ‹‰è’™å¤è‡ªæ²»å·",
    "å·´éŸ³éƒ­æ¥è’™å¤è‡ªæ²»å·",
    "é˜¿å…‹è‹åœ°åŒº",
    "å…‹å­œå‹’è‹æŸ¯å°”å…‹å­œè‡ªæ²»å·",
    "å–€ä»€åœ°åŒº",
    "å’Œç”°åœ°åŒº",
    "ä¼ŠçŠå“ˆè¨å…‹è‡ªæ²»å·",
    "å¡”åŸåœ°åŒº",
    "é˜¿å‹’æ³°åœ°åŒº",
  ],
  é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº: ["é¦™æ¸¯"],
  æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº: ["æ¾³é—¨"],
  å°æ¹¾çœ: ["å°åŒ—", "é«˜é›„"],
};

const taiwanCities = cities["å°æ¹¾çœ"];
const hongkongMacau = ["é¦™æ¸¯", "æ¾³é—¨"];

// æ‰å¹³åŒ–åŸå¸‚åˆ—è¡¨
const allCities = Object.values(cities).flat();

async function fetchCityCoordinates(city) {
  let country = "ä¸­å›½";
  if (taiwanCities.includes(city)) {
    country = "å°æ¹¾";
  } else if (hongkongMacau.includes(city)) {
    country = city; // é¦™æ¸¯ or æ¾³é—¨
  }
  const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(
    city
  )},${encodeURIComponent(country)}&limit=1`;
  try {
    const response = await fetch(url);
    const data = await response.json();
    if (data.length > 0) {
      const { lat, lon } = data[0];
      return [parseFloat(lon), parseFloat(lat)]; // [ç»åº¦, çº¬åº¦]
    } else {
      console.warn(`æœªæ‰¾åˆ° ${city} çš„åæ ‡`);
      return null;
    }
  } catch (error) {
    console.error(`è·å– ${city} åæ ‡å¤±è´¥:`, error.message);
    return null;
  }
}

async function main() {
  console.log("ğŸŒ å¼€å§‹è·å–ä¸­å›½åŸå¸‚ç»çº¬åº¦åæ ‡...");

  const cityCoordinates = {};

  for (const city of allCities) {
    console.log(`ğŸ“ è·å– ${city} åæ ‡...`);
    const coords = await fetchCityCoordinates(city);
    if (coords) {
      cityCoordinates[city] = coords;
    }
    // å»¶è¿Ÿä¸€ä¸‹é¿å…è¯·æ±‚è¿‡å¿«
    await new Promise((resolve) => setTimeout(resolve, 1000));
  }

  // å†™å…¥æ–‡ä»¶
  const outputPath = path.join(__dirname, "../public/data/china.json");
  fs.writeFileSync(outputPath, JSON.stringify(cityCoordinates, null, 2));

  console.log(
    `âœ… æˆåŠŸ! å…±è·å– ${Object.keys(cityCoordinates).length} ä¸ªåŸå¸‚çš„åæ ‡`
  );
  console.log(`ğŸ“ æ•°æ®å·²ä¿å­˜åˆ°: ${outputPath}`);

  // è¾“å‡ºTypeScriptå¯¹è±¡æ ¼å¼
  console.log("\nğŸ“‹ TypeScript å¯¹è±¡æ ¼å¼:");
  console.log("const cityCoordinates: Record<string, [number, number]> = {");
  for (const [city, coords] of Object.entries(cityCoordinates)) {
    console.log(`  "${city}": [${coords[0]}, ${coords[1]}],`);
  }
  console.log("};");
}

main();
